<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Synth√®se CPS ‚Äî Mon Objectif</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script>
if (location.protocol === 'http:' && !/^(localhost|127\.0\.0\.1)$/.test(location.hostname)) {
  location.replace('https://' + location.host + location.pathname + location.search + location.hash);
}
</script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
* { -webkit-tap-highlight-color: transparent; }
button, [role="button"], .act-card, .mission-card, .meteo-card,
.cps-item, .mood-big-btn, .mood-sec-chip {
  touch-action: manipulation;
}
:root{--bg:#faf9f7;--surface:#fff;--border:rgba(0,0,0,.06);--text:#1a1a2e;--text2:#64748b;--text3:#94a3b8;--primary:#6366f1;--primary-light:#eef2ff;--cog:#3b82f6;--cog-bg:rgba(59,130,246,.08);--emo:#f43f5e;--emo-bg:rgba(244,63,94,.08);--soc:#8b5cf6;--soc-bg:rgba(139,92,246,.08);--success:#10b981;--danger:#ef4444;--warn:#f59e0b;--radius:16px;--radius-sm:12px;--shadow:0 2px 8px rgba(0,0,0,.04);--shadow-lg:0 8px 30px rgba(0,0,0,.08);--ease:cubic-bezier(.4,0,.2,1);--font:'Outfit',system-ui,sans-serif}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh}
.page-header{background:var(--surface);padding:14px 20px;display:flex;align-items:center;gap:14px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:50}
.back-btn{width:36px;height:36px;border-radius:10px;border:none;background:var(--bg);cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;text-decoration:none;color:var(--text)}
.page-title{font-weight:800;font-size:.95rem;flex:1}
.page-code{font-size:0.75rem;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px}
.page-body{max-width:520px;margin:0 auto;padding:20px 16px 80px}
.hero{text-align:center;padding:28px 20px;border-radius:var(--radius);margin-bottom:20px}
.hero-emoji{font-size:3rem;margin-bottom:8px}
.hero-title{font-weight:800;font-size:1.2rem;margin-bottom:4px}
.hero-sub{font-size:.82rem;color:var(--text2);line-height:1.5}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:18px;margin-bottom:12px;box-shadow:var(--shadow)}
.card-title{font-size:0.75rem;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);margin-bottom:10px;display:flex;align-items:center;gap:6px}
.card h4{font-size:.88rem;font-weight:800;margin-bottom:8px}
.card p{font-size:.82rem;color:var(--text2);line-height:1.6}
.tag{display:inline-flex;padding:5px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;margin:0 4px 6px 0}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
.stat{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;text-align:center}
.stat-val{font-weight:800;font-size:1.4rem}
.stat-lbl{font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);margin-top:3px}
.accordion{margin-bottom:8px}
.acc-head{width:100%;text-align:left;padding:14px 16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);font-family:var(--font);font-weight:700;font-size:.85rem;cursor:pointer;display:flex;align-items:center;justify-content:space-between;transition:all .15s}
.acc-head:hover{border-color:var(--primary);box-shadow:var(--shadow)}
.acc-head .arrow{transition:transform .2s;font-size:0.75rem;color:var(--text3)}
.acc-head.open .arrow{transform:rotate(90deg)}
.acc-body{display:none;padding:12px 16px;background:var(--surface);border:1px solid var(--border);border-top:none;border-radius:0 0 var(--radius-sm) var(--radius-sm)}
.acc-body.open{display:block}
.spe-item{padding:10px 0;border-bottom:1px solid var(--border)}
.spe-item:last-child{border-bottom:none}
.spe-name{font-weight:700;font-size:.82rem;margin-bottom:4px}
.spe-desc{font-size:0.75rem;color:var(--text3)}
.obj-chip{display:inline-block;padding:5px 12px;background:var(--bg);border-radius:8px;font-size:0.75rem;font-weight:600;color:var(--text2);margin:2px 3px 2px 0}
.goal-mini{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px 14px;margin-bottom:6px;display:flex;align-items:center;gap:8px}
.goal-mini .gm-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.goal-mini .gm-title{font-weight:700;font-size:.78rem;flex:1}
.goal-mini .gm-badge{font-size:0.75rem;font-weight:800;padding:2px 6px;border-radius:4px}
.empty{text-align:center;color:var(--text3);font-size:.8rem;font-style:italic;padding:20px 0}
.section-h{font-size:0.75rem;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);margin:20px 0 10px;display:flex;align-items:center;gap:6px}
.resource-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px 16px;margin-bottom:8px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:all .15s}
.resource-card:hover{box-shadow:var(--shadow);transform:translateY(-1px)}
.resource-card .rc-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.resource-card .rc-name{font-weight:700;font-size:.8rem}
.resource-card .rc-sub{font-size:0.75rem;color:var(--text3)}
.placeholder-box{background:linear-gradient(135deg,rgba(99,102,241,.04),rgba(139,92,246,.04));border:2px dashed rgba(99,102,241,.15);border-radius:var(--radius);padding:28px 20px;text-align:center;margin-bottom:12px}
.placeholder-box .pb-icon{font-size:2rem;margin-bottom:8px}
.placeholder-box p{font-size:.8rem;color:var(--text3);line-height:1.5}
.ref-footer{font-size:0.75rem;color:var(--text3);text-align:center;margin-top:24px;font-style:italic;padding:12px;border-top:1px solid var(--border)}

</style>
</head>
<body>
<header class="page-header">
  <a class="back-btn" onclick="goBack()">‚Üê</a>
  <span class="page-title">üìÑ Ma Synth√®se</span>
  <span class="page-code" id="page-code">‚Äî</span>
</header>
<div class="page-body">
  <div class="hero" style="background:linear-gradient(135deg,rgba(99,102,241,.06),rgba(139,92,246,.04))">
    <div class="hero-emoji">üìä</div>
    <div class="hero-title">Mon profil de comp√©tences</div>
    <div class="hero-sub">Vue d'ensemble de tes comp√©tences psychosociales d√©velopp√©es au fil du temps.</div>
  </div>

  <div id="my-stats"></div>

  <div class="card" style="text-align:center">
    <div class="card-title" style="justify-content:center">üìà Mon radar CPS</div>
    <div style="max-width:280px;margin:0 auto"><canvas id="radar-chart"></canvas></div>
  </div>

  <div class="card" style="border-left:4px solid var(--cog)">
    <h4 style="color:var(--cog)">üß† Cognitif</h4>
    <p id="syn-cog">Chargement‚Ä¶</p>
    <div id="list-cog" style="margin-top:8px"></div>
  </div>
  <div class="card" style="border-left:4px solid var(--emo)">
    <h4 style="color:var(--emo)">‚ù§Ô∏è √âmotionnel</h4>
    <p id="syn-emo">Chargement‚Ä¶</p>
    <div id="list-emo" style="margin-top:8px"></div>
  </div>
  <div class="card" style="border-left:4px solid var(--soc)">
    <h4 style="color:var(--soc)">ü§ù Social</h4>
    <p id="syn-soc">Chargement‚Ä¶</p>
    <div id="list-soc" style="margin-top:8px"></div>
  </div>

  <div class="section-h">üìÖ Historique √©motionnel</div>
  <div id="mood-history"></div>

  <div class="placeholder-box" style="margin-top:20px">
    <div class="pb-icon">üèÖ</div>
    <p><strong>Attestation de comp√©tences</strong><br><br>Quand tu auras valid√© suffisamment d'objectifs, une attestation officielle de tes comp√©tences psychosociales pourra √™tre g√©n√©r√©e ici.<br><br>Continue tes efforts !</p>
  </div>

  <div class="ref-footer">R√©f√©rentiel des comp√©tences psychosociales ‚Äî Sant√© publique France</div>
</div>

<script src="js/data_eleves.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0IQcLI",authDomain:"devoirs-pse.firebaseapp.com",databaseURL:"https://devoirs-pse-default-rtdb.europe-west1.firebasedatabase.app",projectId:"devoirs-pse",storageBucket:"devoirs-pse.appspot.com",messagingSenderId:"614730413904",appId:"1:614730413904:web:a5dd478af5de30f6bede55"};
firebase.initializeApp(firebaseConfig);const db=firebase.database();
const userCode=new URLSearchParams(window.location.search).get('id')||'';
function resolveDataCode(loginCode){if(typeof window.trouverEleve!=='function')return String(loginCode||'').toUpperCase();var e=window.trouverEleve(loginCode);return e&&e.userCode?String(e.userCode).toUpperCase():String(loginCode||'').toUpperCase()}
const dataCode=resolveDataCode(userCode);
document.getElementById('page-code').textContent=userCode||'‚Äî';
function getAx(g){var t=(g.type||g.domaine||'').toUpperCase();return t.includes('COG')?'COG':t.includes('EMO')?'EMO':t.includes('SOC')?'SOC':'NEU'}
function dateFr(d){if(!d)return'‚Äî';return new Date(d).toLocaleDateString('fr-FR',{day:'numeric',month:'short'})}
function daysLeft(d){if(!d)return null;var t=new Date();t.setHours(0,0,0,0);var x=new Date(d);x.setHours(0,0,0,0);return Math.ceil((x-t)/864e5)}
function goBack(){var id=userCode?'?id='+userCode:'';window.location.href='index.html'+id}
// Accordion toggle
document.addEventListener('click',function(e){var head=e.target.closest('.acc-head');if(!head)return;head.classList.toggle('open');var body=head.nextElementSibling;if(body)body.classList.toggle('open')});

var radarChart=null;
db.ref('accompagnement/eleves/'+dataCode).on('value',function(snap){
  var data=snap.val()||{};var goals=data.objectifs||{};
  var counts={COG:0,EMO:0,SOC:0},totals={COG:0,EMO:0,SOC:0},examples={COG:[],EMO:[],SOC:[]};
  Object.values(goals).forEach(function(g){var ax=getAx(g);if(ax==='NEU')return;totals[ax]++;if(g.done){counts[ax]++;if(examples[ax].length<3)examples[ax].push(g.titre||'')}});
  var totalAll=counts.COG+counts.EMO+counts.SOC;
  document.getElementById('my-stats').innerHTML='<div class="stats-grid"><div class="stat"><div class="stat-val" style="color:var(--primary)">'+totalAll+'</div><div class="stat-lbl">Valid√©s</div></div><div class="stat"><div class="stat-val" style="color:var(--cog)">'+counts.COG+'</div><div class="stat-lbl">Cognitif</div></div><div class="stat"><div class="stat-val" style="color:var(--emo)">'+counts.EMO+'</div><div class="stat-lbl">√âmotionnel</div></div></div><div class="stats-grid" style="grid-template-columns:repeat(2,1fr)"><div class="stat"><div class="stat-val" style="color:var(--soc)">'+counts.SOC+'</div><div class="stat-lbl">Social</div></div><div class="stat"><div class="stat-val" style="color:var(--warn)">'+(totals.COG+totals.EMO+totals.SOC-totalAll)+'</div><div class="stat-lbl">En cours</div></div></div>';
  // Radar
  var ctx=document.getElementById('radar-chart');
  if(radarChart)radarChart.destroy();
  radarChart=new Chart(ctx,{type:'radar',data:{labels:['Cognitif','√âmotionnel','Social'],datasets:[{data:[counts.COG,counts.EMO,counts.SOC],backgroundColor:'rgba(99,102,241,.12)',borderColor:'rgba(99,102,241,.5)',borderWidth:2,pointBackgroundColor:'#6366f1',pointRadius:5}]},options:{scales:{r:{beginAtZero:true,ticks:{display:false},grid:{color:'rgba(0,0,0,.05)'},pointLabels:{font:{size:13,weight:'700',family:'Outfit'}}}},plugins:{legend:{display:false}}}});
  // Summaries
  ['COG','EMO','SOC'].forEach(function(ax){
    var id=ax.toLowerCase();
    document.getElementById('syn-'+id).textContent=counts[ax]?counts[ax]+' objectif(s) valid√©(s) sur '+totals[ax]+(examples[ax].length?'. Ex : '+examples[ax].join(', '):''):'Pas encore d\'objectif valid√©.';
    var listHtml='';
    Object.values(goals).filter(function(g){return getAx(g)===ax&&g.done}).forEach(function(g){
      listHtml+='<div class="goal-mini"><span class="gm-dot" style="background:'+(ax==='COG'?'var(--cog)':ax==='EMO'?'var(--emo)':'var(--soc)')+'"></span><span class="gm-title">'+(g.titre||'')+'</span><span class="gm-badge" style="background:rgba(16,185,129,.1);color:var(--success)">'+dateFr(g.date_done)+'</span></div>'});
    document.getElementById('list-'+id).innerHTML=listHtml;
  });
  // Mood history
  var meteo=data.meteo||{};var mKeys=Object.keys(meteo).sort().reverse().slice(0,14);
  if(!mKeys.length){document.getElementById('mood-history').innerHTML='<div class="empty">Pas encore de m√©t√©o √©motionnelle</div>';return}
  var mHtml='';mKeys.forEach(function(d){var m=meteo[d];mHtml+='<div class="goal-mini"><span style="font-size:1.2rem;margin-right:4px">'+(m.emoji||'')+'</span><span class="gm-title">'+m.primary+' ¬∑ '+m.secondary+'</span><span style="font-size:0.75rem;color:var(--text3)">'+d+'</span></div>'});
  document.getElementById('mood-history').innerHTML=mHtml;
});
</script>
</body>
</html>
