<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Formation Sociale ‚Äî Mon Objectif</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script>
if (location.protocol === 'http:' && !/^(localhost|127\.0\.0\.1)$/.test(location.hostname)) {
  location.replace('https://' + location.host + location.pathname + location.search + location.hash);
}
</script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
* { -webkit-tap-highlight-color: transparent; }
button, [role="button"], .act-card, .mission-card, .meteo-card,
.cps-item, .mood-big-btn, .mood-sec-chip {
  touch-action: manipulation;
}
:root{--bg:#faf9f7;--surface:#fff;--border:rgba(0,0,0,.06);--text:#1a1a2e;--text2:#64748b;--text3:#94a3b8;--primary:#6366f1;--primary-light:#eef2ff;--cog:#3b82f6;--cog-bg:rgba(59,130,246,.08);--emo:#f43f5e;--emo-bg:rgba(244,63,94,.08);--soc:#8b5cf6;--soc-bg:rgba(139,92,246,.08);--success:#10b981;--danger:#ef4444;--warn:#f59e0b;--radius:16px;--radius-sm:12px;--shadow:0 2px 8px rgba(0,0,0,.04);--shadow-lg:0 8px 30px rgba(0,0,0,.08);--ease:cubic-bezier(.4,0,.2,1);--font:'Plus Jakarta Sans',system-ui,sans-serif}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh}
.page-header{background:var(--surface);padding:14px 20px;display:flex;align-items:center;gap:14px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:50}
.back-btn{width:36px;height:36px;border-radius:10px;border:none;background:var(--bg);cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;text-decoration:none;color:var(--text)}
.page-title{font-weight:800;font-size:.95rem;flex:1}
.page-code{font-size:0.75rem;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px}
.page-body{max-width:520px;margin:0 auto;padding:20px 16px 80px}
.hero{text-align:center;padding:28px 20px;border-radius:var(--radius);margin-bottom:20px}
.hero-emoji{font-size:3rem;margin-bottom:8px}
.hero-title{font-weight:800;font-size:1.2rem;margin-bottom:4px}
.hero-sub{font-size:.82rem;color:var(--text2);line-height:1.5}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:18px;margin-bottom:12px;box-shadow:var(--shadow)}
.card-title{font-size:0.75rem;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);margin-bottom:10px;display:flex;align-items:center;gap:6px}
.card h4{font-size:.88rem;font-weight:800;margin-bottom:8px}
.card p{font-size:.82rem;color:var(--text2);line-height:1.6}
.tag{display:inline-flex;padding:5px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;margin:0 4px 6px 0}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
.stat{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;text-align:center}
.stat-val{font-weight:800;font-size:1.4rem}
.stat-lbl{font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);margin-top:3px}
.accordion{margin-bottom:8px}
.acc-head{width:100%;text-align:left;padding:14px 16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);font-family:var(--font);font-weight:700;font-size:.85rem;cursor:pointer;display:flex;align-items:center;justify-content:space-between;transition:all .15s}
.acc-head:hover{border-color:var(--primary);box-shadow:var(--shadow)}
.acc-head .arrow{transition:transform .2s;font-size:0.75rem;color:var(--text3)}
.acc-head.open .arrow{transform:rotate(90deg)}
.acc-body{display:none;padding:12px 16px;background:var(--surface);border:1px solid var(--border);border-top:none;border-radius:0 0 var(--radius-sm) var(--radius-sm)}
.acc-body.open{display:block}
.spe-item{padding:10px 0;border-bottom:1px solid var(--border)}
.spe-item:last-child{border-bottom:none}
.spe-name{font-weight:700;font-size:.82rem;margin-bottom:4px}
.spe-desc{font-size:0.75rem;color:var(--text3)}
.obj-chip{display:inline-block;padding:5px 12px;background:var(--bg);border-radius:8px;font-size:0.75rem;font-weight:600;color:var(--text2);margin:2px 3px 2px 0}
.goal-mini{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px 14px;margin-bottom:6px;display:flex;align-items:center;gap:8px}
.goal-mini .gm-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.goal-mini .gm-title{font-weight:700;font-size:.78rem;flex:1}
.goal-mini .gm-badge{font-size:0.75rem;font-weight:800;padding:2px 6px;border-radius:4px}
.empty{text-align:center;color:var(--text3);font-size:.8rem;font-style:italic;padding:20px 0}
.section-h{font-size:0.75rem;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);margin:20px 0 10px;display:flex;align-items:center;gap:6px}
.resource-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px 16px;margin-bottom:8px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:all .15s}
.resource-card:hover{box-shadow:var(--shadow);transform:translateY(-1px)}
.resource-card .rc-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.resource-card .rc-name{font-weight:700;font-size:.8rem}
.resource-card .rc-sub{font-size:0.75rem;color:var(--text3)}
.placeholder-box{background:linear-gradient(135deg,rgba(99,102,241,.04),rgba(139,92,246,.04));border:2px dashed rgba(99,102,241,.15);border-radius:var(--radius);padding:28px 20px;text-align:center;margin-bottom:12px}
.placeholder-box .pb-icon{font-size:2rem;margin-bottom:8px}
.placeholder-box p{font-size:.8rem;color:var(--text3);line-height:1.5}
.ref-footer{font-size:0.75rem;color:var(--text3);text-align:center;margin-top:24px;font-style:italic;padding:12px;border-top:1px solid var(--border)}
.hero{background:linear-gradient(135deg,rgba(139,92,246,.08),rgba(139,92,246,.02))}
</style>
</head>
<body>
<header class="page-header">
  <a class="back-btn" onclick="goBack()">‚Üê</a>
  <span class="page-title">ü§ù Social ‚Äî Se former</span>
  <span class="page-code" id="page-code">‚Äî</span>
</header>
<div class="page-body">
  <div class="hero">
    <div class="hero-emoji">ü§ù</div>
    <div class="hero-title">Le domaine Social</div>
    <div class="hero-sub">Apprendre √† communiquer, coop√©rer et construire des relations positives avec les autres.</div>
  </div>

  <div id="my-stats"></div>

  <div class="card">
    <h4>üí° C'est quoi exactement ?</h4>
    <p>Le domaine social, c'est tout ce qui concerne ta relation aux autres : comment tu parles, comment tu √©coutes, comment tu travailles en groupe, comment tu g√®res les d√©saccords.</p>
    <p style="margin-top:8px"><strong>Communiquer</strong> ‚Äî s'exprimer clairement, √©couter vraiment, adapter son message √† la personne en face.</p>
    <p><strong>Coop√©rer</strong> ‚Äî travailler avec les autres, accepter les diff√©rences, contribuer au groupe.</p>
    <p><strong>S'affirmer</strong> ‚Äî dire ce qu'on pense avec respect, r√©sister √† la pression, poser ses limites.</p>
    <p><strong>R√©soudre les conflits</strong> ‚Äî trouver des solutions quand √ßa ne va pas, sans violence ni fuite.</p>
  </div>

  <div class="card">
    <h4>üìñ Mots-cl√©s</h4>
    <div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:6px">
      <span class="tag" style="background:var(--soc-bg);color:var(--soc)">Communication</span>
      <span class="tag" style="background:var(--soc-bg);color:var(--soc)">Coop√©ration</span>
      <span class="tag" style="background:var(--soc-bg);color:var(--soc)">√âcoute active</span>
      <span class="tag" style="background:var(--soc-bg);color:var(--soc)">Entraide</span>
      <span class="tag" style="background:var(--soc-bg);color:var(--soc)">Assertivit√©</span>
      <span class="tag" style="background:var(--soc-bg);color:var(--soc)">Respect</span>
      <span class="tag" style="background:var(--soc-bg);color:var(--soc)">R√©solution de conflits</span>
      <span class="tag" style="background:var(--soc-bg);color:var(--soc)">Empathie</span>
    </div>
  </div>

  <div class="section-h">üìö Les comp√©tences en d√©tail</div>
  <div id="competences-list"></div>

  <div class="section-h">‚è≥ Mes objectifs sociaux</div>
  <div id="my-goals"></div>

  <div class="section-h">üîó Ressources et exercices</div>
  <div class="placeholder-box">
    <div class="pb-icon">üí¨</div>
    <p>Des exercices de communication, des mises en situation et des fiches sur la gestion de conflits seront ajout√©s ici par ton enseignant.</p>
  </div>

  <div class="ref-footer">R√©f√©rentiel des comp√©tences psychosociales ‚Äî Sant√© publique France</div>
</div>

<script src="js/data_eleves.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0IQcLI",authDomain:"devoirs-pse.firebaseapp.com",databaseURL:"https://devoirs-pse-default-rtdb.europe-west1.firebasedatabase.app",projectId:"devoirs-pse",storageBucket:"devoirs-pse.appspot.com",messagingSenderId:"614730413904",appId:"1:614730413904:web:a5dd478af5de30f6bede55"};
firebase.initializeApp(firebaseConfig);const db=firebase.database();
const SESSION_CODE_KEY='accompagnement_session_code';
function sanitizeCode(v){return String(v||'').toUpperCase().replace(/[^A-Z0-9]/g,'').slice(0,16)}
const userCode=sanitizeCode(sessionStorage.getItem(SESSION_CODE_KEY)||'');
if(!/^[A-Z0-9]{4,16}$/.test(userCode)){window.location.href='index.html';throw new Error('Session √©l√®ve manquante');}
function resolveDataCode(loginCode){if(typeof window.trouverEleve!=='function')return String(loginCode||'').toUpperCase();var e=window.trouverEleve(loginCode);return e&&e.userCode?String(e.userCode).toUpperCase():String(loginCode||'').toUpperCase()}
const dataCode=resolveDataCode(userCode);
document.getElementById('page-code').textContent=userCode||'‚Äî';
function getAx(g){var t=(g.type||g.domaine||'').toUpperCase();return t.includes('COG')?'COG':t.includes('EMO')?'EMO':t.includes('SOC')?'SOC':'NEU'}
function dateFr(d){if(!d)return'‚Äî';return new Date(d).toLocaleDateString('fr-FR',{day:'numeric',month:'short'})}
function daysLeft(d){if(!d)return null;var t=new Date();t.setHours(0,0,0,0);var x=new Date(d);x.setHours(0,0,0,0);return Math.ceil((x-t)/864e5)}
function goBack(){window.location.href='index.html'}
// Accordion toggle
document.addEventListener('click',function(e){var head=e.target.closest('.acc-head');if(!head)return;head.classList.toggle('open');var body=head.nextElementSibling;if(body)body.classList.toggle('open')});

var AX='SOC';
db.ref('accompagnement/eleves/'+dataCode).on('value',function(snap){
  var data=snap.val()||{};var goals=data.objectifs||{};
  var mine=Object.entries(goals).filter(function(e){return getAx(e[1])===AX});
  var doneC=mine.filter(function(e){return e[1].done}).length;
  var activeC=mine.filter(function(e){return!e[1].done}).length;
  document.getElementById('my-stats').innerHTML='<div class="stats-grid"><div class="stat"><div class="stat-val" style="color:var(--soc)">'+mine.length+'</div><div class="stat-lbl">Total</div></div><div class="stat"><div class="stat-val" style="color:var(--success)">'+doneC+'</div><div class="stat-lbl">Valid√©s</div></div><div class="stat"><div class="stat-val" style="color:var(--warn)">'+activeC+'</div><div class="stat-lbl">En cours</div></div></div>';
  var goalsHtml='';
  if(!mine.length)goalsHtml='<div class="empty">Pas encore d\'objectif social</div>';
  else mine.forEach(function(e){var g=e[1];var dl=daysLeft(g.date_cible);var badge=g.done?'<span class="gm-badge" style="background:rgba(16,185,129,.1);color:var(--success)">Valid√©</span>':'<span class="gm-badge" style="background:rgba(245,158,11,.1);color:var(--warn)">'+(dl!==null&&dl>=0?'J-'+dl:'En cours')+'</span>';
    goalsHtml+='<div class="goal-mini"><span class="gm-dot" style="background:var(--soc)"></span><span class="gm-title">'+(g.titre||'')+'</span>'+badge+'</div>'});
  document.getElementById('my-goals').innerHTML=goalsHtml;
});
fetch('data/bibliotheque/scolaire.json').then(function(r){return r.json()}).then(function(data){
  var dom=data.domaine_social;if(!dom)return;var html='';
  (dom.categories||[]).forEach(function(cat){
    (cat.competences_generales||[]).forEach(function(gen){
      html+='<div class="accordion"><button class="acc-head"><span style="color:var(--soc)">'+gen.nom_gen+'</span><span class="arrow">‚ñ∂</span></button><div class="acc-body">';
      (gen.competences_specifiques||[]).forEach(function(spe){
        html+='<div class="spe-item"><div class="spe-name">'+spe.nom_spe+'</div><div style="margin-top:4px">';
        (spe.objectifs_eleve||[]).forEach(function(o){html+='<span class="obj-chip">'+o.texte+'</span>'});
        html+='</div></div>'});
      html+='</div></div>'});
  });
  document.getElementById('competences-list').innerHTML=html;
});
</script>
</body>
</html>
